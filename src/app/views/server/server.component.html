
<div class="relative w-screen bg-base-100 mx-auto px-4 flex flex-col flex-1 text-base-content justify-center items-center" *ngIf="speechQuery.state$ | async as speechState">
<!--  <button class="absolute right-4 top-4 btn btn-accent btn-circle btn-sm" [tippy]="help" variation="popper" placement="bottom">-->
<!--    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">-->
<!--      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />-->
<!--    </svg>-->
<!--  </button>-->
  <h1 class="font-bold text-5xl mb-8">OBS STT</h1>
  <div class="flex flex-col space-y-2 w-72">

    <ng-container [ngSwitch]="applicationQuery.connectionState$ | async">
      <ng-container *ngSwitchCase="0">
        <select class="select select-bordered w-full max-w-xs" [ngModel]="speechState.selectedLanguage[0]" (ngModelChange)="speechService.SelectLanguage($event)">
          <option [disabled]="true">Choose your language</option>
          <option [value]="index" *ngFor="let lang of langs; let index = index">{{lang[0]}}</option>
        </select>
        <select *ngIf="langs[speechState.selectedLanguage[0]].length > 2" class="select select-bordered w-full max-w-xs" [ngModel]="speechState.selectedLanguage[1]" (ngModelChange)="speechService.SelectDialect($event)">
          <option [disabled]="true">Choose your Dialect</option>
          <option [value]="index" *ngFor="let lang of langs[speechState.selectedLanguage[0]] | slice:1; let index = index">{{lang[1]}}</option>
        </select>
        <div class="form-control" *ngIf="networkQuery.state$ | async as networkState">
          <label class="cursor-pointer label">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor" tippy="Use this if you don't want to update OBS browser source every time">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
              </svg>
              <span class="label-text">Remember source</span>
            </div>
            <div>
              <input type="checkbox" checked="checked" class="toggle" [ngModel]="networkState.saveHost" (ngModelChange)="networkService.SwitchSaveHost()">
              <span class="toggle-mark"></span>
            </div>
          </label>
<!--          <label class="cursor-pointer label">-->
<!--            <span class="label-text">Remember generated link</span>-->
<!--            <div>-->
<!--              <input type="checkbox" checked="checked" class="checkbox checkbox-primary" [ngModel]="networkState.saveHost" (ngModelChange)="networkService.SwitchSaveHost()">-->
<!--              <span class="checkbox-mark"></span>-->
<!--            </div>-->
<!--          </label>-->
        </div>
        <button class="btn btn-primary" (click)="applicationService.StartHost()">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Start</button>
      </ng-container>
      <ng-container *ngSwitchCase="1">
        Connecting
      </ng-container>
      <div class="flex flex-col justify-center" *ngSwitchCase="2">
        <div class="border-dotted border-2  border-base-300 self-center mb-8 rounded-md">
          <app-stt-renderer></app-stt-renderer>
        </div>

        <button (click)="applicationService.StopHost()" class="btn mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z" />
          </svg>
          Stop server</button>
        <button (click)="applicationService.CopyLink()" class="btn btn-ghost mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2" />
          </svg>
          Copy link</button>
        <button [tippy]="customization" variation="popper" placement="bottom" class="fixed top-10 left-10 btn btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg>
          Customization
        </button>
      </div>
    </ng-container>
  </div>
  <div *ngIf="!usable" class="p-8 flex justify-center items-center absolute top-0 bottom-0 left-0 right-0 bg-base-300 opacity-90">
    <div class="flex items-center">
      <img width="35" class="mr-4" src="assets/pepehands.gif">
      <span>STT only works in <b>Chrome</b> and <b>Edge 92 or higher *</b> <br>
        <small>* For Edge 92 search "edge canary"</small>
      </span>
    </div>
  </div>
</div>

<ng-template #customization>
  <div class="w-72 flex flex-col space-y-4" *ngIf="styleQuery.current$ | async as currentStyle">
    <div class="tabs self-center">
      <a class="tab px-2 tab-bordered" [class.tab-active]="activeTab === 'text'" (click)="ChangeTab('text')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7" />
        </svg>
        Text</a>
      <a class="tab px-2 tab-bordered" [class.tab-active]="activeTab === 'box'" (click)="ChangeTab('box')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
        </svg>
        Box</a>
      <a class="tab px-2 tab-bordered" [class.tab-active]="activeTab === 'avatar'" (click)="ChangeTab('avatar')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        Avatar</a>
      <a class="tab px-2 tab-bordered" [class.tab-active]="activeTab === 'global'" (click)="ChangeTab('global')">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        Global
      </a>
    </div>

    <ng-container [ngSwitch]="activeTab">
      <ng-container *ngSwitchCase="'text'">
        <div class="text-xl font-bold mb-2 opacity-80 text-base-content">Text style</div>
        <div class="flex justify-between items-center">
          <div>Text color</div>
          <button class="btn btn-sm btn-circle" [tippy]="text_color" variation="color_menu" placement="right" [style.background-color]="currentStyle.textStyle.color.value"></button>
        </div>
        <div class="flex justify-between items-center">
          <div>Font size</div>
          <input type="number" min="0" max="48" class="w-16 input input-bordered input-sm" [ngModel]="currentStyle.textStyle.fontSize.value" (ngModelChange)="styleService.UpdateTextStyle({fontSize: $event})">
        </div>
        <div class="flex justify-between items-center">
          <div>Font weight</div>
          <div class="btn-group">
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({fontWeight: 'normal'})" [class.btn-active]="currentStyle.textStyle.fontWeight.value === 'normal'">Aa</button>
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({fontWeight: 'bold'})" [class.btn-active]="currentStyle.textStyle.fontWeight.value === 'bold'"><span style="font-weight: bold">Aa</span></button>
          </div>
        </div>
        <div class="flex justify-between items-center">
          <div>Letter case</div>
          <div class="btn-group">
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({textTransform: 'none'})" [class.btn-active]="currentStyle.textStyle.textTransform.value === 'none'">-</button>
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({textTransform: 'capitalize'})" [class.btn-active]="currentStyle.textStyle.textTransform.value === 'capitalize'">Aa</button>
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({textTransform: 'uppercase'})" [class.btn-active]="currentStyle.textStyle.textTransform.value === 'uppercase'">AA</button>
            <button class="btn btn-sm normal-case" (click)="styleService.UpdateTextStyle({textTransform: 'lowercase'})" [class.btn-active]="currentStyle.textStyle.textTransform.value === 'lowercase'">aa</button>
          </div>
        </div>
        <div class="flex justify-between items-center">
          <div>Text shadow</div>
          <button class="btn btn-sm btn-circle" [tippy]="text_shadow_color" variation="color_menu" placement="right" [style.background-color]="currentStyle.textStyleComposite.textShadow.color.value"></button>
        </div>
        <div class="pl-4 space-y-2 flex flex-col">
          <div class="flex justify-between items-center">
            <div>Shadow x</div>
            <input type="number" min="0" max="20" class="w-16 input input-bordered input-sm" [ngModel]="currentStyle.textStyleComposite.textShadow.x.value" (ngModelChange)="styleService.UpdateTextComposite('textShadow', {x: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Shadow y</div>
            <input type="number" min="0" max="20" class="w-16 input input-bordered input-sm" [ngModel]="currentStyle.textStyleComposite.textShadow.y.value" (ngModelChange)="styleService.UpdateTextComposite('textShadow', {y: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Shadow Blur</div>
            <input type="number" min="0" max="20" class="w-16 input input-bordered input-sm" [ngModel]="currentStyle.textStyleComposite.textShadow.b.value" (ngModelChange)="styleService.UpdateTextComposite('textShadow', {b: $event})">
          </div>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'box'">
        <div class="text-xl font-bold mb-2 opacity-80 text-base-content">Box style</div>
        <div class="flex justify-between items-center">
          <div>Background color</div>
          <button class="btn btn-sm btn-circle" [tippy]="background_color" variation="color_menu" placement="right" [style.background-color]="currentStyle.boxStyle.backgroundColor.value"></button>
        </div>
        <div class="pl-4 space-y-2 flex flex-col">
          <div class="flex justify-between items-center">
            <div>Width</div>
            <input type="number" min="0" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.boxStyle.width.value" (ngModelChange)="styleService.UpdateBoxStyle({width: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Height</div>
            <input type="number" min="0" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.boxStyle.height.value" (ngModelChange)="styleService.UpdateBoxStyle({height: $event})">
          </div>
        </div>

        <div class="flex justify-between items-center">
          <div>Border size</div>
          <input type="number" min="0" max="20" class="w-16 input input-bordered input-sm" [ngModel]="currentStyle.boxStyle.borderWidth.value" (ngModelChange)="styleService.UpdateBoxStyle({borderWidth: $event})">
        </div>
        <div class="flex justify-between items-center">
          <div>Border color</div>
          <button class="btn btn-sm btn-circle" [tippy]="box_border_color" variation="color_menu" placement="right" [style.background-color]="currentStyle.boxStyle.borderColor.value"></button>
        </div>
        <div class="flex justify-between items-center">
          <div>Corner radius</div>
          <input type="range" min="0" max="20" class="range" [ngModel]="currentStyle.boxStyle.borderRadius.value" (ngModelChange)="styleService.UpdateBoxStyle({borderRadius: $event})">
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'avatar'">
        <div class="text-xl font-bold mb-2 opacity-80 text-base-content">Avatar style</div>
        <div class="flex justify-between items-center">
          <div>Image url</div>
          <input class="w-44 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.backgroundImage.value" (ngModelChange)="styleService.UpdateAvatarStyle({backgroundImage: $event})">
        </div>

        <div class="pl-4 space-y-2 flex flex-col">
          <div class="flex justify-between items-center">
            <div>Width</div>
            <input type="number" min="0" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.width.value" (ngModelChange)="styleService.UpdateAvatarStyle({width: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Height</div>
            <input type="number" min="0" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.height.value" (ngModelChange)="styleService.UpdateAvatarStyle({height: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Position X</div>
            <input type="number" min="-100" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.marginRight.value" (ngModelChange)="styleService.UpdateAvatarStyle({marginRight: $event})">
          </div>
          <div class="flex justify-between items-center">
            <div>Position Y</div>
            <input type="number" min="-100" max="100" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.marginBottom.value" (ngModelChange)="styleService.UpdateAvatarStyle({marginBottom: $event})">
          </div>
        </div>
        <div class="flex justify-between items-center">
          <div>Animation</div>
          <select class="w-44 select select-bordered select-sm" [ngModel]="currentStyle.avatarStyle.animationName.value" (ngModelChange)="styleService.UpdateAvatarStyle({animationName: $event})">
            <option value="none">None</option>
            <option value="avatar-floating">Floating</option>
          </select>
        </div>

        <div class="pl-4 flex justify-between items-center">
          <div>Animation length</div>
          <input type="number" min="0" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.avatarStyle.animationDuration.value" (ngModelChange)="styleService.UpdateAvatarStyle({animationDuration: $event})">
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="'global'">
        <div class="text-xl font-bold mb-2 opacity-80 text-base-content">Global settings</div>
        <div class="form-control">
          <label class="cursor-pointer p-0 label">
            <span class="label-text">Always show</span>
            <div>
              <input type="checkbox" checked="checked" class="toggle" [ngModel]="!!currentStyle.globalStyle.alwaysShow.value" (ngModelChange)="styleService.UpdateGlobalStyle({alwaysShow: $event ? '1' : ''})">
              <span class="toggle-mark"></span>
            </div>
          </label>
        </div>
        <div class="form-control">
          <label class="cursor-pointer p-0 label">
            <span class="label-text">Clear when hidden</span>
            <div>
              <input type="checkbox" checked="checked" class="toggle" [ngModel]="!!currentStyle.globalStyle.clearOnHide.value" (ngModelChange)="styleService.UpdateGlobalStyle({clearOnHide: $event ? '1' : ''})">
              <span class="toggle-mark"></span>
            </div>
          </label>
        </div>
        <div class="flex justify-between items-center">
          <div>Hide after (ms)</div>
          <input type="number" min="100" max="20000" class="w-24 input input-bordered input-sm" [ngModel]="currentStyle.globalStyle.hideAfter.value" (ngModelChange)="styleService.UpdateGlobalStyle({hideAfter: $event})">
        </div>
      </ng-container>
    </ng-container>
  </div>
</ng-template>

<ng-template #text_color>
  <div class="w-44" *ngIf="styleQuery.current$ | async as currentStyle">
    <color-sketch [color]="currentStyle.textStyle.color.value" (onChange)="styleService.UpdateTextStyle({color: RgbaToString($event.color.rgb)})"></color-sketch>
  </div>
</ng-template>

<ng-template #text_shadow_color>
  <div class="w-44" *ngIf="styleQuery.current$ | async as currentStyle">
    <color-sketch [color]="currentStyle.textStyleComposite.textShadow.color.value" (onChange)="styleService.UpdateTextComposite('textShadow', {color: RgbaToString($event.color.rgb)})"></color-sketch>
  </div>
</ng-template>

<ng-template #background_color>
  <div class="w-44" *ngIf="styleQuery.current$ | async as currentStyle">
    <color-sketch [color]="currentStyle.boxStyle.backgroundColor.value" (onChange)="styleService.UpdateBoxStyle({backgroundColor: RgbaToString($event.color.rgb)})"></color-sketch>
  </div>
</ng-template>

<ng-template #box_border_color>
  <div class="w-44" *ngIf="styleQuery.current$ | async as currentStyle">
    <color-sketch [color]="currentStyle.boxStyle.borderColor.value" (onChange)="styleService.UpdateBoxStyle({borderColor: RgbaToString($event.color.rgb)})"></color-sketch>
  </div>
</ng-template>


<ng-template #help>
  <div class="flex flex-col space-y-4">
    <div class="text-xl font-bold">Elp</div>
    <div>1. Choose language</div>
    <div>2. Type password</div>
  </div>
</ng-template>
