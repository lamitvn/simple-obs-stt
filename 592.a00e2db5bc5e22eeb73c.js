(self.webpackChunksimple_obs_stt=self.webpackChunksimple_obs_stt||[]).push([[592],{3640:(t,e,n)=>{"use strict";n.d(e,{E:()=>F,B:()=>Q});var i=n(4762),a=n(1116),s=n(3235),o=n(9713),l=n(2629),r=n(7425),c=n(8102),h=n(9234),u=n(3386),d=n(4659);class p{constructor(t,e,n){this.initialData=t,this.rendererInstance=e,this.options=n,this.Value=new r.X([]),this.isPlayed=!1,this.cancelToken=!1,this.data=Object.assign({},t)}Run(){return(0,i.mG)(this,void 0,void 0,function*(){!this.isPlayed&&this.data.finalized&&(yield this.options.animate?this.RunStagger():this.RunSimple(),this.isPlayed=!0)})}Dispose(){this.cancelToken=!0,this.Value.complete()}RunSimple(){return(0,i.mG)(this,void 0,void 0,function*(){this.Value.next(this.data.valueNext),this.options.onActivity(),this.options.onUpdateRenderer()})}RunStagger(){return new Promise((t,e)=>{let n=new Array(this.data.valueNext.length).fill(null).map((t,e)=>new Array(this.data.valueNext[e].length).fill(null)),i=0,a=0;var s,o,l,r;(l=this.options.interval,void 0===l&&(l=0),void 0===r&&(r=c.z),l<0&&(l=0),(0,h.H)(l,l,r)).pipe((s=t=>!this.cancelToken&&a<this.data.valueNext.length,void 0===o&&(o=!1),(0,u.e)(function(t,e){t.subscribe(new d.Q(e,function(t){var n=s();(n||o)&&e.next(t),!n&&e.complete()}))}))).subscribe({next:()=>{const t=this.data.valueNext[a];this.options.animateWords?(n[a]=t,a++,this.options.onActivity()):i<t.length?(n[a][i]=t[i],i++," "!==t[i]&&this.options.onActivity()):(a++,i=0),this.Value.next(n),this.options.onUpdateRenderer()},complete:()=>t(null)})})}Finalize(t){this.data=t,this.data.finalized&&this.Run()}Update(t){this.data=t,this.options.animate||(this.Value.next(t.valueNext),this.options.onActivity(),this.options.onUpdateRenderer())}}var v=n(2926),y=n(4818),m=n(1664),x=n(3917),g=n(7083);const f=["avatarElement"],S=["boxElement"],R=["textElement"],b=function(t,e){return{value:t,params:e}};function w(t,e){if(1&t&&v._UZ(0,"div",13),2&t){const t=e.$implicit,n=v.oxw(4).ngIf,i=v.oxw();v.Q6J("@listAnimation",v.WLB(2,b,t,i.GetRandomizedParams(n)))("innerHTML",t,v.oJD)}}function A(t,e){if(1&t&&(v.TgZ(0,"div",11),v.YNc(1,w,1,5,"div",12),v.qZA()),2&t){const t=e.$implicit,n=v.oxw().$implicit,i=v.oxw(3);v.ekj("opacity-70",!n.data.finalized),v.xp6(1),v.Q6J("ngForOf",t)("ngForTrackBy",i.trackLetter)}}function k(t,e){if(1&t&&(v.ynx(0),v.YNc(1,A,2,4,"div",10),v.ALo(2,"async"),v.BQk()),2&t){const t=e.$implicit,n=v.oxw(3);v.xp6(1),v.Q6J("ngForOf",v.lcZ(2,2,t.Value))("ngForTrackBy",n.trackWord)}}function E(t,e){if(1&t&&(v.ynx(0),v.TgZ(1,"div",1),v._UZ(2,"div",2,3),v.TgZ(4,"div",4,5),v.TgZ(6,"div",6,7),v.YNc(8,k,3,4,"ng-container",8),v._UZ(9,"div",9),v.qZA(),v.qZA(),v.qZA(),v.BQk()),2&t){const t=e.ngIf,n=v.oxw().ngIf,i=v.oxw();v.xp6(2),v.ekj("hidden",!n.avatarStyle.backgroundImage.value[0]),v.xp6(4),v.ekj("host",2===t.connectionState),v.xp6(2),v.Q6J("ngForOf",i.list)("ngForTrackBy",i.track),v.xp6(1),v.Q6J("innerHTML"," ",v.oJD)}}function T(t,e){if(1&t&&(v.ynx(0),v.YNc(1,E,10,7,"ng-container",0),v.ALo(2,"async"),v.BQk()),2&t){const t=v.oxw();v.xp6(1),v.Q6J("ngIf",v.lcZ(2,1,t.speechQuery.state$))}}let F=(()=>{class t{constructor(t,e,n,i){this.speechQuery=t,this.speechService=e,this.styleQuery=n,this.soundService=i,this.track=(t,e)=>e.data.id,this.trackWord=(t,e)=>t,this.trackLetter=(t,e)=>e,this.GetRandomRange=(t,e)=>Math.random()*(e-t)+t,this.mappedList={},this.list=[],this.isRunningSentence=!1,this.lastRunningSentence=-1}GetRandomizedParams(t){const e=t.textStyle.scaleMin.value[0],n=t.textStyle.scaleMax.value[0],i=t.textStyle.rotationMin.value[0],a=t.textStyle.rotationMax.value[0],s=t.textStyle.translationXMin.value[0],o=t.textStyle.translationXMax.value[0],l=t.textStyle.translationYMin.value[0],r=t.textStyle.translationYMax.value[0];return{time:this.GetRandomRange(t.textStyle.durationMin.value[0],t.textStyle.durationMax.value[0]).toFixed(1),scale:this.GetRandomRange(e,n).toFixed(1),rotation:this.GetRandomRange(i,a).toFixed(1),translateX:this.GetRandomRange(s,o).toFixed(1),translateY:this.GetRandomRange(l,r).toFixed(1)}}ApplyElementStyleDAta(t,e,n,i,a){var o;for(const l in i){const r=null===(o=s.nS[e])||void 0===o?void 0:o[l];i[l].type!==s.RS.logic?r?r(t,n.style,(0,s.$4)(i[l],a),a):n.style[l]=(0,s.$4)(i[l],a):r&&r(t,n.style,(0,s.$4)(i[l],a),a)}}ApplyStyles(t,e){this.ApplyElementStyleDAta(t,"avatarStyle",this.avatarElement.nativeElement,t.avatarStyle,e),this.ApplyElementStyleDAta(t,"boxStyle",this.boxElement.nativeElement,t.boxStyle,e),this.ApplyElementStyleDAta(t,"textStyle",this.textElement.nativeElement,t.textStyle,e)}ngAfterViewInit(){(0,l.WZ)([this.styleQuery.current$,this.speechQuery.showBubble$]).subscribe(([t,e])=>{this.ApplyStyles(t,e?0:1)})}AnimateScroll(){setTimeout(()=>{var t,e,n,i;return null===(n=null===(e=null===(t=this.textElement)||void 0===t?void 0:t.nativeElement)||void 0===e?void 0:e.scrollTo)||void 0===n?void 0:n.call(e,{top:null===(i=this.textElement.nativeElement)||void 0===i?void 0:i.scrollHeight,behavior:"smooth"})},50)}CreateSentence(t){const e=this.styleQuery.getValue().currentStyle.globalStyle,n=new p(t,this,{animate:!!e.typingAnimation.value[0],animateWords:!!e.typeWords.value[0],interval:e.typingDelay.value[0],onUpdateRenderer:()=>this.AnimateScroll(),onActivity:()=>{this.speechService.TriggerShowTimer(),this.soundService.Play()}});this.list.push(n),this.mappedList[t.id]=n}TryRunNext(){return(0,i.mG)(this,void 0,void 0,function*(){if(this.isRunningSentence)return;const t=this.list.find(t=>!t.isPlayed&&t.data.finalized);t&&(this.isRunningSentence=!0,yield t.Run(),this.isRunningSentence=!1,this.TryRunNext())})}Clear(){this.list.forEach(t=>t.Dispose()),this.list=[],this.lastRunningSentence=-1,this.isRunningSentence=!1}ngOnInit(){this.speechQuery.onClear$.subscribe(t=>this.Clear()),this.speechQuery.onSentenceUpdate$.subscribe(t=>{var e;t&&(this.mappedList[t.id]?null===(e=this.mappedList[t.id])||void 0===e||e.Update(t):this.CreateSentence(t),this.TryRunNext())})}}return t.\u0275fac=function(e){return new(e||t)(v.Y36(y.v),v.Y36(m.v),v.Y36(x.B),v.Y36(g.y))},t.\u0275cmp=v.Xpm({type:t,selectors:[["app-stt-renderer"]],viewQuery:function(t,e){if(1&t&&(v.Gf(f,5),v.Gf(S,5),v.Gf(R,5)),2&t){let t;v.iGM(t=v.CRH())&&(e.avatarElement=t.first),v.iGM(t=v.CRH())&&(e.boxElement=t.first),v.iGM(t=v.CRH())&&(e.textElement=t.first)}},decls:2,vars:3,consts:[[4,"ngIf"],[1,"flex","stt-container","flex","items-end","relative"],[1,"stt-box-avatar","pointer-events-none","z-50","w-36","h-36","bg-contain","bg-center","bg-no-repeat",2,"animation-iteration-count","infinite","animation-timing-function","ease-in-out"],["avatarElement",""],[1,"stt-box-container","relative","stt-box","flex","flex-col","bg-cover","bg-center"],["boxElement",""],[1,"stt-box-text","inset-0","flex","flex-wrap","break-words","min-h-8","overflow-y-scroll","overflow-x-hidden"],["textElement",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"whitespace-pre-wrap",3,"innerHTML"],["class","flex whitespace-pre-wrap",3,"opacity-70",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","whitespace-pre-wrap"],[3,"innerHTML",4,"ngFor","ngForOf","ngForTrackBy"],[3,"innerHTML"]],template:function(t,e){1&t&&(v.YNc(0,T,3,3,"ng-container",0),v.ALo(1,"async")),2&t&&v.Q6J("ngIf",v.lcZ(1,1,e.styleQuery.current$))},directives:[a.O5,a.sg],pipes:[a.Ov],encapsulation:2,data:{animation:[(0,o.X$)("listAnimation",[(0,o.eR)(":enter",[(0,o.oB)({opacity:0,transform:"rotate({{rotation}}deg) scale({{scale}}) translateX({{translateX}}px) translateY({{translateY}}px)"}),(0,o.jt)("{{time}}s",(0,o.oB)({opacity:1,transform:"rotate(0) scale(1) translateX(0) translateY(0)"}))])]),(0,o.X$)("opacity",[])]},changeDetection:0}),t})(),Q=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=v.oAB({type:t}),t.\u0275inj=v.cJS({imports:[[a.ez]]}),t})()}}]);