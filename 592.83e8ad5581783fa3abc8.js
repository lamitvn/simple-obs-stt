(self.webpackChunksimple_obs_stt=self.webpackChunksimple_obs_stt||[]).push([[592],{3640:(t,e,i)=>{"use strict";i.d(e,{E:()=>Q,B:()=>F});var n=i(4762),a=i(1116),s=i(3235),o=i(9713),l=i(2629),r=i(7425),c=i(8102),h=i(9234),u=i(3386),d=i(4659);class p{constructor(t,e,i){this.initialData=t,this.rendererInstance=e,this.options=i,this.Value=new r.X([]),this.isPlayed=!1,this.cancelToken=!1,this.data=Object.assign({},t)}Run(){return(0,n.mG)(this,void 0,void 0,function*(){!this.isPlayed&&this.data.finalized&&(yield this.options.animate?this.RunStagger():this.RunSimple(),this.isPlayed=!0)})}Dispose(){this.cancelToken=!0,this.Value.complete()}RunSimple(){return(0,n.mG)(this,void 0,void 0,function*(){this.Value.next(this.data.valueNext),this.options.onActivity(),this.options.onUpdateRenderer()})}RunStagger(){return new Promise((t,e)=>{let i=new Array(this.data.valueNext.length).fill(null).map((t,e)=>new Array(this.data.valueNext[e].length).fill(null)),n=0,a=0;var s,o,l,r;(l=this.options.interval,void 0===l&&(l=0),void 0===r&&(r=c.z),l<0&&(l=0),(0,h.H)(l,l,r)).pipe((s=t=>!this.cancelToken&&a<this.data.valueNext.length,void 0===o&&(o=!1),(0,u.e)(function(t,e){t.subscribe(new d.Q(e,function(t){var i=s();(i||o)&&e.next(t),!i&&e.complete()}))}))).subscribe({next:()=>{const t=this.data.valueNext[a];this.options.animateWords?(i[a]=t,a++,this.options.onActivity()):n<t.length?(i[a][n]=t[n],n++," "!==t[n]&&this.options.onActivity()):(a++,n=0),this.Value.next(i),this.options.onUpdateRenderer()},complete:()=>t(null)})})}Finalize(t){this.data=t,this.data.finalized&&this.Run()}Update(t){this.data=t,this.options.animate||(this.Value.next(t.valueNext),this.options.onActivity(),this.options.onUpdateRenderer())}}var y=i(2926),v=i(4818),m=i(1664),x=i(3917),g=i(7083);const f=["avatarElement"],S=["boxElement"],R=["textElement"],b=function(t,e){return{value:t,params:e}};function w(t,e){if(1&t&&y._UZ(0,"div",13),2&t){const t=e.$implicit,i=y.oxw(4).ngIf,n=y.oxw();y.Q6J("@listAnimation",y.WLB(2,b,t,n.GetRandomizedParams(i)))("innerHTML",t,y.oJD)}}function A(t,e){if(1&t&&(y.TgZ(0,"div",11),y.YNc(1,w,1,5,"div",12),y.qZA()),2&t){const t=e.$implicit,i=y.oxw().$implicit,n=y.oxw(3);y.ekj("opacity-70",!i.data.finalized),y.xp6(1),y.Q6J("ngForOf",t)("ngForTrackBy",n.trackLetter)}}function k(t,e){if(1&t&&(y.ynx(0),y.YNc(1,A,2,4,"div",10),y.ALo(2,"async"),y.BQk()),2&t){const t=e.$implicit,i=y.oxw(3);y.xp6(1),y.Q6J("ngForOf",y.lcZ(2,2,t.Value))("ngForTrackBy",i.trackWord)}}function E(t,e){if(1&t&&(y.ynx(0),y.TgZ(1,"div",1),y._UZ(2,"div",2,3),y.TgZ(4,"div",4,5),y.TgZ(6,"div",6,7),y.YNc(8,k,3,4,"ng-container",8),y._UZ(9,"div",9),y.qZA(),y.qZA(),y.qZA(),y.BQk()),2&t){const t=e.ngIf,i=y.oxw().ngIf,n=y.oxw();y.xp6(2),y.ekj("hidden",!i.avatarStyle.backgroundImage.value[0]),y.xp6(4),y.ekj("host",2===t.connectionState),y.xp6(2),y.Q6J("ngForOf",n.list)("ngForTrackBy",n.track),y.xp6(1),y.Q6J("innerHTML"," ",y.oJD)}}function T(t,e){if(1&t&&(y.ynx(0),y.YNc(1,E,10,7,"ng-container",0),y.ALo(2,"async"),y.BQk()),2&t){const t=y.oxw();y.xp6(1),y.Q6J("ngIf",y.lcZ(2,1,t.speechQuery.state$))}}let Q=(()=>{class t{constructor(t,e,i,n){this.speechQuery=t,this.speechService=e,this.styleQuery=i,this.soundService=n,this.track=(t,e)=>e.data.id,this.trackWord=(t,e)=>t,this.trackLetter=(t,e)=>e,this.GetRandomRange=(t,e)=>Math.random()*(e-t)+t,this.mappedList={},this.list=[],this.isRunningSentence=!1}GetRandomizedParams(t){const e=t.textStyle.scaleMin.value[0],i=t.textStyle.scaleMax.value[0],n=t.textStyle.rotationMin.value[0],a=t.textStyle.rotationMax.value[0],s=t.textStyle.translationXMin.value[0],o=t.textStyle.translationXMax.value[0],l=t.textStyle.translationYMin.value[0],r=t.textStyle.translationYMax.value[0];return{time:this.GetRandomRange(t.textStyle.durationMin.value[0],t.textStyle.durationMax.value[0]).toFixed(1),scale:this.GetRandomRange(e,i).toFixed(1),rotation:this.GetRandomRange(n,a).toFixed(1),translateX:this.GetRandomRange(s,o).toFixed(1),translateY:this.GetRandomRange(l,r).toFixed(1)}}ApplyElementStyleDAta(t,e,i,n,a){var o;for(const l in n){const r=null===(o=s.nS[e])||void 0===o?void 0:o[l];n[l].type!==s.RS.logic?r?r(t,i.style,(0,s.$4)(n[l],a),a):i.style[l]=(0,s.$4)(n[l],a):r&&r(t,i.style,(0,s.$4)(n[l],a),a)}}ApplyStyles(t,e){this.ApplyElementStyleDAta(t,"avatarStyle",this.avatarElement.nativeElement,t.avatarStyle,e),this.ApplyElementStyleDAta(t,"boxStyle",this.boxElement.nativeElement,t.boxStyle,e),this.ApplyElementStyleDAta(t,"textStyle",this.textElement.nativeElement,t.textStyle,e)}ngAfterViewInit(){(0,l.WZ)([this.styleQuery.current$,this.speechQuery.showBubble$]).subscribe(([t,e])=>{this.ApplyStyles(t,e?0:1)})}AnimateScroll(){setTimeout(()=>{var t,e,i,n;return null===(i=null===(e=null===(t=this.textElement)||void 0===t?void 0:t.nativeElement)||void 0===e?void 0:e.scrollTo)||void 0===i?void 0:i.call(e,{top:null===(n=this.textElement.nativeElement)||void 0===n?void 0:n.scrollHeight,behavior:"smooth"})},50)}CreateSentence(t){const e=this.styleQuery.getValue().currentStyle.globalStyle,i=new p(t,this,{animate:!!e.typingAnimation.value[0],animateWords:!!e.typeWords.value[0],interval:e.typingDelay.value[0],onUpdateRenderer:()=>this.AnimateScroll(),onActivity:()=>{this.speechService.TriggerShowTimer(),this.soundService.Play()}});this.list.push(i),this.mappedList[t.id]=i}TryRunNext(){return(0,n.mG)(this,void 0,void 0,function*(){if(this.isRunningSentence)return;const t=this.list.find(t=>!t.isPlayed&&t.data.finalized);t&&(this.styleQuery.getValue().currentStyle.globalStyle.keepSingleSentence.value[0]&&(this.list=this.list.filter(t=>(t.isPlayed&&t.Dispose(),!t.isPlayed))),this.isRunningSentence=!0,yield t.Run(),this.isRunningSentence=!1,this.TryRunNext())})}Clear(){this.list.forEach(t=>t.Dispose()),this.list=[],this.isRunningSentence=!1}ngOnInit(){this.speechQuery.onClear$.subscribe(t=>this.Clear()),this.speechQuery.onSentenceUpdate$.subscribe(t=>{var e;t&&(this.mappedList[t.id]?null===(e=this.mappedList[t.id])||void 0===e||e.Update(t):this.CreateSentence(t),this.TryRunNext())})}}return t.\u0275fac=function(e){return new(e||t)(y.Y36(v.v),y.Y36(m.v),y.Y36(x.B),y.Y36(g.y))},t.\u0275cmp=y.Xpm({type:t,selectors:[["app-stt-renderer"]],viewQuery:function(t,e){if(1&t&&(y.Gf(f,5),y.Gf(S,5),y.Gf(R,5)),2&t){let t;y.iGM(t=y.CRH())&&(e.avatarElement=t.first),y.iGM(t=y.CRH())&&(e.boxElement=t.first),y.iGM(t=y.CRH())&&(e.textElement=t.first)}},decls:2,vars:3,consts:[[4,"ngIf"],[1,"flex","stt-container","flex","items-end","relative"],[1,"stt-box-avatar","pointer-events-none","z-50","w-36","h-36","bg-contain","bg-center","bg-no-repeat",2,"animation-iteration-count","infinite","animation-timing-function","ease-in-out"],["avatarElement",""],[1,"stt-box-container","relative","stt-box","flex","flex-col","bg-cover","bg-center"],["boxElement",""],[1,"stt-box-text","inset-0","flex","flex-wrap","break-words","min-h-8","overflow-y-scroll","overflow-x-hidden"],["textElement",""],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"whitespace-pre-wrap",3,"innerHTML"],["class","flex whitespace-pre-wrap",3,"opacity-70",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","whitespace-pre-wrap"],[3,"innerHTML",4,"ngFor","ngForOf","ngForTrackBy"],[3,"innerHTML"]],template:function(t,e){1&t&&(y.YNc(0,T,3,3,"ng-container",0),y.ALo(1,"async")),2&t&&y.Q6J("ngIf",y.lcZ(1,1,e.styleQuery.current$))},directives:[a.O5,a.sg],pipes:[a.Ov],encapsulation:2,data:{animation:[(0,o.X$)("listAnimation",[(0,o.eR)(":enter",[(0,o.oB)({opacity:0,transform:"rotate({{rotation}}deg) scale({{scale}}) translateX({{translateX}}px) translateY({{translateY}}px)"}),(0,o.jt)("{{time}}s",(0,o.oB)({opacity:1,transform:"rotate(0) scale(1) translateX(0) translateY(0)"}))])]),(0,o.X$)("opacity",[])]},changeDetection:0}),t})(),F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=y.oAB({type:t}),t.\u0275inj=y.cJS({imports:[[a.ez]]}),t})()}}]);